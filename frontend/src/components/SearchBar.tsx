"use client"; import { useState, useEffect, useRef } from "react"; import { useRouter } from "next/navigation"; import { getAssetUrl } from "../lib/utils"; interface Suggestion { id: string; name: string; logoUrl?: string; isVerified: boolean; averageRating: number; totalRatings: number; } export default function SearchBar() { const [query, setQuery] = useState(""); const [suggestions, setSuggestions] = useState<Suggestion[]>([]); const [isOpen, setIsOpen] = useState(false); const router = useRouter(); const containerRef = useRef<HTMLDivElement>(null); useEffect(() => { const handleClickOutside = (event: MouseEvent) => { if ( containerRef.current && !containerRef.current.contains(event.target as Node) ) { setIsOpen(false); } }; document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); useEffect(() => { const fetchSuggestions = async () => { if (query.length < 2) { setSuggestions([]); setIsOpen(false); return; } try { const apiUrl = process.env.NEXT_PUBLIC_API_URL || "http://127.0.0.1:4000"; const res = await fetch( `${apiUrl}/brands/public/search?q=${encodeURIComponent(query)}` ); if (res.ok) { const data = await res.json(); setSuggestions(data); setIsOpen(true); } } catch (error) { console.error("Failed to fetch suggestions:", error); } }; const timeoutId = setTimeout(fetchSuggestions, 300); return () => clearTimeout(timeoutId); }, [query]); const handleSearch = (e: React.FormEvent) => { e.preventDefault(); if (!query.trim()) return; router.push(`/complaints?search=${encodeURIComponent(query)}`); setIsOpen(false); }; const handleSuggestionClick = (suggestion: Suggestion) => { router.push(`/brands/${suggestion.id}`); setQuery(suggestion.name); setIsOpen(false); }; return ( <div ref={containerRef} className="w-full max-w-2xl mx-auto mt-12 animate-in slide-in-from-bottom duration-1000 delay-300 relative z-[100]" > <form onSubmit={handleSearch} className="relative group p-1.5 bg-background/50 backdrop-blur-xl border-2 border-primary/20 rounded-2xl shadow-xl focus-within:border-primary transition-all duration-300 flex items-center gap-2" > <div className="pl-4 text-primary/50 group-focus-within:text-primary transition-colors"> <span className="material-symbols-outlined text-xl">search</span> </div> <input type="text" value={query} onChange={(e) => setQuery(e.target.value)} onFocus={() => query.length >= 2 && setIsOpen(true)} placeholder="Find a business you can trust..." className="w-full bg-transparent border-none py-3 px-2 text-base focus:outline-none placeholder:text-muted-foreground/50 font-medium" /> <button type="submit" className="px-6 py-2.5 bg-primary text-white text-sm font-black rounded-xl hover:scale-105 active:scale-95 transition-all shadow-md shadow-primary/30" > Search </button> </form> {/* Suggestions Dropdown */} {isOpen && suggestions.length > 0 && ( <div className="absolute top-full left-0 right-0 mt-[-20px] bg-background/95 backdrop-blur-xl border border-border rounded-2xl shadow-2xl overflow-hidden z-50 animate-in fade-in slide-in-from-top-4 duration-300"> <div className="p-1.5"> {suggestions.map((suggestion) => ( <button key={suggestion.id} onClick={() => handleSuggestionClick(suggestion)} className="w-full flex items-center justify-between p-3 hover:bg-primary/5 rounded-xl transition-colors group" > <div className="flex items-center gap-4"> <div className="w-10 h-10 rounded-xl bg-muted overflow-hidden flex items-center justify-center border border-border group-hover:border-primary/20 transition-colors"> {suggestion.logoUrl ? ( <img src={getAssetUrl(suggestion.logoUrl)} alt={suggestion.name} className="w-full h-full object-contain" /> ) : ( <span className="text-lg font-black text-muted-foreground/40"> {suggestion.name[0]} </span> )} </div> <div className="text-left"> <div className="flex items-center gap-2"> <span className="font-bold text-base group-hover:text-primary transition-colors"> {suggestion.name} </span> {suggestion.isVerified && ( <span className="material-symbols-outlined text-primary text-[12px] variation-fill"> verified </span> )} </div> <span className="text-[10px] text-muted-foreground font-black tracking-widest"> Brand </span> </div> </div> <div className="flex flex-col items-end gap-1"> <div className="flex items-center gap-1"> <span className="text-sm font-black text-primary"> {suggestion.averageRating.toFixed(1)} </span> <div className="flex gap-0.5"> {[...Array(5)].map((_, i) => ( <span key={i} className={`material-symbols-outlined text-[14px] ${ i < Math.round(suggestion.averageRating) ? "text-yellow-400 variation-fill" : "text-muted" }`} > star </span> ))} </div> </div> <span className="text-[9px] text-muted-foreground font-bold tracking-widest"> {suggestion.totalRatings} ratings </span> </div> </button> ))} </div> </div> )} <div className="mt-4 flex justify-center items-center gap-4 text-xs font-bold text-muted-foreground/60 tracking-widest "> <span>Trending:</span> {["Checkers", "FNB", "Takealot"].map((brand) => ( <button key={brand} onClick={() => { setQuery(brand); router.push(`/complaints?search=${encodeURIComponent(brand)}`); }} className="hover:text-primary transition-colors border-b border-transparent hover:border-primary" > {brand} </button> ))} </div> </div> ); } 